(* ::Package:: *)

(* ::Input:: *)
(*filepath=NotebookDirectory[](* \:0444\:0430\:0439\:043b\:044b weight spectrum.nb, data.txt \:0438 result.txt \:043d\:0430\:0445\:043e\:0434\:044f\:0442\:0441\:044f \:0432 \:043e\:0434\:043d\:043e\:0439 \:043f\:0430\:043f\:043a\:0435*)*)
(*basis=ToExpression[(Characters@DeleteDuplicates[Import[FileNameJoin[{filepath,"data.txt"}],"Lines"]])];*)
(*ws=WeightSpectrumGrayCode[basis]*)
(**)
(*(* \:043a\:043e\:043c\:043f\:0438\:043b\:044f\:0446\:0438\:044f \:0432\:044b\:0447\:0438\:0441\:043b\:0435\:043d\:0438\:044f \:0432\:0435\:0441\:043e\:0432\:043e\:0433\:043e \:0441\:043f\:0435\:043a\:0442\:0440\:0430 *)*)
(*(* WeightSpectrum=*)
(*Compile[{{basevectors,_Integer,2}},*)
(*Module[{*)
(*n=Dimensions[basevectors][[-1]], (* \:0440\:0430\:0437\:043c\:0435\:0440\:043d\:043e\:0441\:0442\:044c \:0432\:0435\:043a\:0442\:043e\:0440\:043e\:0432 *)*)
(*k=Length[basevectors],  (* \:043a\:043e\:043b\:0438\:0447\:0435\:0441\:0442\:0432\:043e \:0432\:0435\:043a\:0442\:043e\:0440\:043e\:0432 *)*)
(*s=Table[0,{i,0,Dimensions[basevectors][[-1]]}]      *)
(* (* \:0441\:043e\:0437\:0434\:0430\:0435\:0442\:0441\:044f \:0440\:0435\:0437\:0443\:043b\:044c\:0442\:0438\:0440\:0443\:044e\:0449\:0438\:0439 \:0441\:043f\:0438\:0441\:043e\:043a,\:043a\:043e\:0442\:043e\:0440\:044b\:0439 \:0441\:043e\:0434\:0435\:0440\:0436\:0438\:0442 \:043a\:043e\:043b\:0438\:0447\:0435\:0441\:0442\:0432\:043e \:0432\:0441\:0435\:0445 \:0432\:0435\:043a\:0442\:043e\:0440\:043e\:0432 \:0441 \:043e\:043f\:0440\:0435\:0434\:0435\:043b\:0435\:043d\:043d\:044b\:043c \:0432\:0435\:0441\:043e\:043c \:0438 \:0437\:0430\:043f\:043e\:043b\:043d\:044f\:0435\:0442\:0441\:044f \:043d\:0443\:043b\:044f\:043c\:0438. *)
(*\:0438\:043d\:0434\:0435\:043a\:0441 \:0432 \:0441\:043f\:0438\:0441\:043a\:0435 - \:044d\:0442\:043e \:0438 \:0435\:0441\:0442\:044c \:0432\:0435\:0441 \:0432\:0435\:043a\:0442\:043e\:0440\:0430,\:0437\:043d\:0430\:0447\:0435\:043d\:0438\:0435 \:044d\:043b\:0435\:043c\:0435\:043d\:0442\:0430 \:043f\:043e \:0438\:043d\:0434\:0435\:043a\:0441\:0443 - \:0435\:0441\:0442\:044c \:043a\:043e\:043b\:0438\:0447\:0435\:0441\:0442\:0432\:043e \:0432\:0435\:043a\:0442\:043e\:0440\:043e\:0432 \:0441 \:0432\:0435\:0441\:043e\:043c \:0440\:0430\:0432\:043d\:044b\:043c \:0438\:043d\:0434\:0435\:043a\:0441\:0443 *)*)
(*},*)
(*Do[*)
(*With[{l=Total[Mod[Total[IntegerDigits[b,2,k]*basevectors],2]]+1},*)
(*(* \:0440\:0430\:0441\:0441\:0447\:0438\:0442\:044b\:0432\:0430\:0435\:0442\:0441\:044f \:0432\:0435\:0441 \:0434\:043b\:044f \:043e\:043f\:0440\:0435\:0434\:0435\:043b\:0435\:043d\:043d\:043e\:0433\:043e \:043d\:0430\:0431\:043e\:0440\:0430 \:0438\:0437 bi-\:044b\:0445 \:0438 \:0438\:043d\:0434\:0435\:043a\:0441 \:0434\:043b\:044f \:043f\:043e\:043b\:0443\:0447\:0435\:043d\:043d\:043e\:0433\:043e \:0432\:0435\:0441\:0430 \:0443\:0432\:0435\:043b\:0438\:0447\:0438\:0432\:0430\:0435\:0442\:0441\:044f \:043d\:0430 \:0435\:0434\:0438\:043d\:0438\:0446\:0443 *)*)
(*s[[l]]=s[[l]]+1],*)
(*{b,0,2^k-1}];*)
(*Return[Transpose[{Range[0,Last[Dimensions[basis]]],s}]]*)
(*]*)
(*];   *)*)
(**)
(*(* \:043a\:043e\:043c\:043f\:0438\:043b\:044f\:0446\:0438\:044f \:0432\:044b\:0447\:0438\:0441\:043b\:0435\:043d\:0438\:044f \:0432\:0435\:0441\:043e\:0432\:043e\:0433\:043e \:0441\:043f\:0435\:043a\:0442\:0440\:0430 \:0441 \:0438\:0441\:043f\:043e\:043b\:044c\:0437\:043e\:0432\:0430\:043d\:0438\:0435\:043c \:043a\:043e\:0434\:0430 \:0413\:0440\:0435\:044f *)*)
(*WeightSpectrumGrayCode=*)
(*Compile[{{basevectors,_Integer,2}},*)
(*Module[{*)
(*n=Dimensions[basevectors][[-1]], (* \:0440\:0430\:0437\:043c\:0435\:0440\:043d\:043e\:0441\:0442\:044c \:0432\:0435\:043a\:0442\:043e\:0440\:043e\:0432 *)*)
(*k=Length[basevectors], (* \:043a\:043e\:043b\:0438\:0447\:0435\:0441\:0442\:0432\:043e \:0432\:0435\:043a\:0442\:043e\:0440\:043e\:0432 *)*)
(*s=Table[0,{n+1}],       (* \:0441\:043e\:0437\:0434\:0430\:0435\:0442\:0441\:044f \:0440\:0435\:0437\:0443\:043b\:044c\:0442\:0438\:0440\:0443\:044e\:0449\:0438\:0439 \:0441\:043f\:0438\:0441\:043e\:043a, \:043a\:043e\:0442\:043e\:0440\:044b\:0439 \:0441\:043e\:0434\:0435\:0440\:0436\:0438\:0442 \:043a\:043e\:043b\:0438\:0447\:0435\:0441\:0442\:0432\:043e \:0432\:0441\:0435\:0445 \:0432\:0435\:043a\:0442\:043e\:0440\:043e\:0432 \:0441 \:043e\:043f\:0440\:0435\:0434\:0435\:043b\:0435\:043d\:043d\:044b\:043c \:0432\:0435\:0441\:043e\:043c \:0438 \:0437\:0430\:043f\:043e\:043b\:043d\:044f\:0435\:0442\:0441\:044f \:043d\:0443\:043b\:044f\:043c\:0438 *)*)
(*currentVector=Table[0,{n}],*)
(*(* \:043f\:0435\:0440\:0432\:0430\:044f \:043a\:043e\:043c\:0431\:0438\:043d\:0430\:0446\:0438\:044f \:0432\:0441\:0435\:0433\:0434\:0430 {0,0,..} *)*)
(*m=0,l=0*)
(*},*)
(*(* \:0442\:043e\:0447\:043d\:043e \:0438\:0437\:0432\:0435\:0441\:0442\:043d\:043e, \:0447\:0442\:043e \:0432 \:0441\:043f\:0435\:043a\:0442\:0440\:0435 \:0443 0 \:0431\:0443\:0434\:0435\:0442 \:0432\:0435\:0441 \:0431\:043e\:043b\:044c\:0448\:0435 \:0438\:043b\:0438 \:0440\:0430\:0432\:0435\:043d 1, \:0442\:0430\:043a \:043a\:0430\:043a \:043f\:0435\:0440\:0432\:0430\:044f \:043b\:0438\:043d\:0435\:0439\:043d\:0430\:044f \:043a\:043e\:043c\:0431\:0438\:043d\:0430\:0446\:0438\:044f \:0432\:0441\:0435\:0433\:0434\:0430 \:044f\:0432\:043b\:044f\:0435\:0442\:0441\:044f \:043d\:0443\:043b\:0435\:0432\:044b\:043c \:0432\:0435\:043a\:0442\:043e\:0440\:043e\:043c *)*)
(*s[[1]]=1;*)
(*(* \:043f\:0440\:0435\:0434\:043f\:043e\:043b\:043e\:0436\:0438\:043c, \:0447\:0442\:043e \:043f\:043e \:0441\:043f\:0438\:0441\:043a\:0443 bi \:0440\:0430\:0437\:043d\:0438\:0446\:0430 \:043c\:0435\:0436\:0434\:0443 \:043f\:0440\:0435\:0434\:0441\:0442\:0430\:0432\:043b\:0435\:043d\:0438\:0435\:043c bk \:0438 *)
(*bk+1 \:0432\:0441\:0435\:0433\:043e \:0432 \:043d\:0435\:0441\:043a\:043e\:043b\:044c\:043a\:0438\:0445 \:0431\:0438\:0442\:0430\:0445, \:0442\:043e\:0433\:0434\:0430 \:043c\:043e\:0436\:043d\:043e \:043f\:043e\:043b\:0443\:0447\:0438\:0442\:044c \:043b\:0438\:043d\:0435\:0439\:043d\:0443\:044e \:043a\:043e\:043c\:0431\:0438\:043d\:0430\:0446\:0438\:044e *)
(*\:0441 \:043d\:043e\:043c\:0435\:0440\:043e\:043c k \:0438 \:043f\:0440\:0438\:0431\:0430\:0432\:0438\:0442\:044c \:043a \:043d\:0435\:0439 \:0442\:043e\:043b\:044c\:043a\:043e \:0442\:0435 \:0431\:0430\:0437\:0438\:0441\:043d\:044b\:0435 \:0432\:0435\:043a\:0442\:043e\:0440\:0430, *)
(*\:0438\:043d\:0434\:0435\:043a\:0441 \:043a\:043e\:0442\:043e\:0440\:044b\:0445 \:0441\:043e\:0432\:043f\:0430\:0434\:0430\:0435\:0442 \:0441 \:043d\:043e\:043c\:0435\:0440\:0430\:043c\:0438 \:043e\:0442\:043b\:0438\:0447\:0430\:044e\:0449\:0438\:0445\:0441\:044f \:0431\:0438\:0442 \:043c\:0435\:0436\:0434\:0443 k \:0438 *)
(*k+1. \:0440\:0435\:0437\:0443\:043b\:044c\:0442\:0430\:0442\:043e\:043c \:0431\:0443\:0434\:0435\:0442 \:043b\:0438\:043d\:0435\:0439\:043d\:0430\:044f \:043a\:043e\:043c\:0431\:0438\:043d\:0430\:0446\:0438\:044f k+1 *)*)
(*Do[*)
(*(*\:043f\:043e\:0437\:0438\:0446\:0438\:044f \:0438\:0437\:043c\:0435\:043d\:0438\:0432\:0448\:0435\:0433\:043e\:0441\:044f \:0431\:0438\:0442\:0430*)*)
(*m=Log2[BitAnd[-1-b,b+1]]+1;*)
(*(* \:0437\:0434\:0435\:0441\:044c \:043d\:0435\:0442 \:043f\:043e\:043b\:043d\:043e\:0433\:043e \:0441\:043b\:043e\:0436\:0435\:043d\:0438\:044f \:0432\:0435\:043a\:0442\:043e\:0440\:043e\:0432, \:0430 \:0442\:043e\:043b\:044c\:043a\:043e \:043f\:0440\:0438\:0431\:0430\:0432\:043b\:0435\:043d\:0438\:0435 \:0440\:0430\:0437\:043d\:0438\:0446\:044b *)*)
(*currentVector=BitXor[currentVector,basevectors[[m]]];*)
(*(*\:043f\:043e\:0434\:0441\:0447\:0435\:0442 \:0432\:0435\:0441\:0430*)*)
(*l=Total[currentVector]+1;*)
(*s[[l]]=s[[l]]+1,*)
(*{b,0,2^k-2}*)
(*];*)
(*Return[Transpose[{Range[0,Last[Dimensions[basis]]],s}]]*)
(*]*)
(*]; *)
(*(* \:0440\:0430\:0437\:0434\:0435\:043b\:0438\:043c \:0434\:0438\:0430\:043f\:0430\:0437\:043e\:043d \:0432\:0441\:0435\:0445 \:043a\:043e\:043c\:0431\:0438\:043d\:0430\:0446\:0438\:0439 \:043d\:0430 \:0440\:0430\:0432\:043d\:044b\:0435 \:0447\:0430\:0441\:0442\:0438 \:0432 \:0437\:0430\:0432\:0438\:0441\:0438\:043c\:043e\:0441\:0442\:0438 \:043e\:0442 \:043a\:043e\:043b\:0438\:0447\:0435\:0441\:0442\:0432\:0430 \:0434\:043e\:0441\:0442\:0443\:043f\:043d\:044b\:0445 \:044f\:0434\:0435\:0440,\:0442\:043e \:0435\:0441\:0442\:044c \:0432 \:0440\:0435\:0437\:0443\:043b\:044c\:0442\:0430\:0442\:0435 \:043a\:0430\:0436\:0434\:043e\:0435 \:044f\:0434\:0440\:043e \:0432\:043e\:0437\:0432\:0440\:0430\:0449\:0430\:0435\:0442 \:0447\:0430\:0441\:0442\:0438\:0447\:043d\:044b\:0439 \:0441\:043f\:0435\:043a\:0442\:0440 *)*)
(*partition[{i1_Integer,iN_Integer},n_Integer]:=*)
(*With[{dn=Round[(iN-i1+1)/n]},*)
(*Join[*)
(*{{i1,i1+dn-1}},*)
(*Table[{dn*(i-1),i*dn-1},{i,2,n-1}],*)
(*{{(n-1)*dn,iN}}*)
(*]*)
(*]*)
(*(* \:043e\:0442\:043f\:0440\:0430\:0432\:043b\:044f\:0435\:043c \:044d\:0442\:0438 \:0432\:044b\:0447\:0438\:0441\:043b\:0435\:043d\:0438\:044f \:043d\:0430 \:0440\:0430\:0437\:043d\:044b\:0435 \:044f\:0434\:0440\:0430 *)*)
(*WeightSpectrumCodeParallel[basis:{{__Integer}..}]:=*)
(*With[{*)
(*kernels=(If[Kernels[]==={},LaunchKernels[]];Kernels[]),*)
(*parts=partition[{0,2^Length[basis]-1},Length[Kernels[]]]*)
(*},*)
(*Total[WaitAll[Table[*)
(*ParallelEvaluate[ParallelSubmit[WeightSpectrumGrayCode[basis,parts[[$KernelID]]]],kernel],*)
(*{kernel,kernels}*)
(*]]]*)
(*]*)
(*(* \:043f\:043e\:043a\:0430\:0437\:0430\:0442\:044c \:0432\:0440\:0435\:043c\:044f \:0432\:044b\:0447\:0438\:0441\:043b\:0435\:043d\:0438\:0439 *)*)
(*AbsoluteTiming[ParallelEvaluate[WeightSpectrumGrayCode[basis]];][[1]]*)
(*(* \:043f\:043e\:043a\:0430\:0437\:0430\:0442\:044c \:0432\:0441\:0435 \:0437\:0430\:043f\:0443\:0449\:0435\:043d\:043d\:044b\:0435 \:044f\:0434\:0440\:0430 *)*)
(*Kernels[]*)
(*(* \:0441\:043e\:0445\:0440\:0430\:043d\:044f\:0435\:043c \:0440\:0435\:0437\:0443\:043b\:044c\:0442\:0430\:0442 \:0432 \:0444\:0430\:0439\:043b result.txt *)*)
(*Export[FileNameJoin[{filepath,"result.txt"}], ws,"Table","FieldSeparators"-> "\t"]*)
(*(* \:0441\:043c\:043e\:0442\:0440\:0438\:043c \:043d\:0430 \:0440\:0435\:0437\:0443\:043b\:044c\:0442\:0430\:0442 \:0432 \:0444\:0430\:0439\:043b\:0435 *)*)
(*SystemOpen[%]*)
(*(* \:0432\:0438\:0437\:0443\:0430\:043b\:0438\:0437\:0438\:0440\:0443\:0435\:043c \:0432\:0435\:0441\:043e\:0432\:043e\:0439 \:0441\:043f\:0435\:043a\:0442\:0440 *)*)
(*ListPlot[ws,PlotTheme->"DarkColor",AxesLabel->{"\:0412\:0435\:0441","\:041a\:043e\:043b\:0438\:0447\:0435\:0441\:0442\:0432\:043e"},AxesOrigin->{0,0},PlotRange->All,Filling->Bottom]*)
